<div class="page-header-main">
  <div class="row align-items-center justify-content-between">
    <div class="col-md-auto col-sm-auto">
      <div class="content-header svg-icons" [ngClass]="{'content-header-ar':translationService.getSelectedLanguage()=='ar'}">
        <h1><i class="icon19"></i> <span>{{'SIDEBAR.PURCHASE_INVOICE' | translate}}</span></h1>
      </div>
    </div>
    <div class="col-md-auto col-sm-auto">
      <!-- *hasClaim="'product_product_create_product'" -->
      <button  class="btn blue-btn btn-sm m-right-10"
        [routerLink]="['/purchase-invoice/manage/add']">
        <i class="fas fa-plus"></i> {{'PURCHASE_INVOICE.ADD_PURCHASE' | translate}}
      </button>
    </div>
  </div>
  <div class="breadcrump-pages" [ngClass]="{'breadcrump-pages-ar':translationService.getSelectedLanguage()=='ar'}">
    <div class="crumbs-sec">
      <a [routerLink]="['/']" >{{'SIDEBAR.DASHBOARD' | translate}}</a> / <span>{{'SIDEBAR.PURCHASE_INVOICE' | translate}}</span>
    </div>
  </div>
</div>
<div class="loading-shade" *ngIf="(dataSource.loading$ | async) ||isLoading$">
  <mat-spinner></mat-spinner>
</div>


<form autocomplete="off" [formGroup]="searchForm" (ngSubmit)="onSearchSubmit()" [ngClass]="{'form-label-ar':translationService.getSelectedLanguage()=='ar'}">
  <div class="filter-sec mb-4">
    <div class="row">
      <div class="col-md-10">
        <div class="row">
          <div class="col-md-3">
             <app-branch-dropdown [group]="searchForm" [controlName]="'branchUUID'" (branchUUID)="parentBranchHandlerFunction($event)"></app-branch-dropdown>
          </div>
          <div class="col-md-3">
             <app-device-dropdown [branch]="branchUUID" [group]="searchForm" [controlName]="'deviceUUID'"></app-device-dropdown>
          </div>
          <div class="col-md-3">
            <date-input [group]="searchForm" [controlName]="'fromDate'" [label]="'COMMON.FROM'" [validationMessage]="'VALIDATIONS.PLEASE_CHOOSE_FROM_DATE'" [isMandatory]="true"></date-input>
          </div> 
          <div class="col-md-3">
            <date-input [group]="searchForm" [controlName]="'toDate'" [label]="'COMMON.TO'" [validationMessage]="'VALIDATIONS.PLEASE_CHOOSE_TO_DATE'" [isMandatory]="true" ></date-input>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="filter-search">
        <button type="submit"  class="btn btn-success btn-sm m-right-10">{{'COMMON.SEARCH' | translate}}</button>
        </div>
      </div>
    </div>
  </div>
</form>


<div class="row">
  <div class="col-sm-12">
    <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" multiTemplateDataRows
        class="table table-bordered table-hover grid-height" matSort matSortActive="docNo">
        <ng-container matColumnDef="action">
          <th class="table-column-150" mat-header-cell *matHeaderCellDef>
          </th>
          <td class="table-column-150" mat-cell *matCellDef="let po">
            <ng-container *hasClaim="'purchase_purchase_invoice_list_purchase_invoice_items'">
            <i class="fas fa-chevron-right btn" *ngIf="po != expandedElement" (click)="toggleRow(po)"></i>
            <i class="fas fa-chevron-down btn" *ngIf="po == expandedElement" (click)="toggleRow(po)"></i>
          </ng-container>

            <button class="ml-4" *hasClaim="'purchase_purchase_invoice_view_purchase_invoice'"
              mat-icon-button [matMenuTriggerFor]="menu" aria-label="Action">
              <mat-icon>more_vert</mat-icon >
            </button>
            <mat-menu #menu="matMenu">
              <button *hasClaim="'purchase_purchase_invoice_view_purchase_invoice'"  mat-menu-item
                [routerLink]="['/purchase-invoice/detail', po.purchaseInvoiceUUID]"
                >
                <mat-icon>info</mat-icon>
                <span>{{'COMMON.DETAIL' | translate}}</span>
              </button>
              <button   mat-menu-item
                [routerLink]="['/purchase-invoice/manage', po.purchaseInvoiceUUID]"
                >
                <mat-icon>edit</mat-icon>
                <span>{{'COMMON.EDIT' | translate}}</span>
              </button>
              <button  mat-menu-item (click)="generateBarcode(po.purchaseInvoiceUUID)">
                <mat-icon>aspect_ratio</mat-icon>
                <span>{{'COMMON.GENERATE_BARCODE' | translate}}</span>
              </button>
              <button  mat-menu-item (click)="deletePurchase(po)">
                <mat-icon>delete</mat-icon>
                <span>{{'COMMON.DELETE' | translate}}</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>
        <ng-container matColumnDef="docDate">
          <th class="table-column-100" mat-header-cell *matHeaderCellDef mat-sort-header> {{'PURCHASE_INVOICE.DOC_DATE' | translate}} </th>
          <td class="table-column-100" mat-cell *matCellDef="let po"> {{po.invoiceDate  | customDate }} </td>
        </ng-container>
        <ng-container matColumnDef="docNo">
          <th class="table-column-150" mat-header-cell *matHeaderCellDef mat-sort-header> {{'PURCHASE_INVOICE.DOC_NO' | translate}} </th>
          <td class="table-column-150" mat-cell *matCellDef="let po"> {{po.invoiceNumber }} </td>
        </ng-container>
        <ng-container matColumnDef="refBillDate">
          <th class="table-column-100" mat-header-cell *matHeaderCellDef > {{'PURCHASE_INVOICE.REF_BILL_DATE' | translate}} </th>
          <td class="table-column-100" mat-cell *matCellDef="let po"> {{po.refBillDate  | customDate }} </td>
        </ng-container>
        <ng-container matColumnDef="refBillNo">
          <th class="table-column-150" mat-header-cell *matHeaderCellDef >{{'PURCHASE_INVOICE.REF_BILL_NO' | translate}} </th>
          <td class="table-column-150" mat-cell *matCellDef="let po"> {{po.refBillNo }} </td>
        </ng-container>
        <ng-container matColumnDef="supplierName">
          <th class="table-column-150" mat-header-cell *matHeaderCellDef > {{'PURCHASE_INVOICE.SUPPLIER_NAME' | translate}} </th>
          <td class="table-column-100" mat-cell *matCellDef="let po"> {{translationService.getSelectedLanguage()=='en'?po?.supplier?.nameEnglish:po?.supplier?.nameSecondLanguage }}
          </td>
        </ng-container>
        <ng-container matColumnDef="transactionMode">
          <th class="table-column-150" mat-header-cell *matHeaderCellDef >  {{'PURCHASE_INVOICE.TRANSACTION_MODE' | translate}}</th>
          <td class="table-column-100" mat-cell *matCellDef="let po"> {{ po.transactionModeText}} </td>
        </ng-container>
        <ng-container matColumnDef="totalDiscount">
          <th class="text-right" class="table-column-150" mat-header-cell  *matHeaderCellDef> {{'PURCHASE_INVOICE.TOTAL_DISCOUNT' | translate}} </th>
          <td class="text-right" class="table-column-150" mat-cell *matCellDef="let po" [innerHTML]="po.totalDiscount| customCurrency">

          </td>
        </ng-container>
        <ng-container matColumnDef="totalCgstAmount">
          <th mat-header-cell *matHeaderCellDef  class="text-right"> {{'PURCHASE_INVOICE.CGST' | translate}} </th>
          <td class="text-right" mat-cell *matCellDef="let po" [innerHTML]="po.totalCgstAmount | customCurrency">
          </td>
        </ng-container>
        <ng-container matColumnDef="totalSgstAmount">
          <th mat-header-cell *matHeaderCellDef  class="text-right"> {{'PURCHASE_INVOICE.SGST' | translate}} </th>
          <td class="text-right" mat-cell *matCellDef="let po" [innerHTML]="po.totalSgstAmount | customCurrency">
          </td>
        </ng-container>
        <ng-container matColumnDef="totalIgstAmount">
          <th mat-header-cell *matHeaderCellDef  class="text-right"> {{'PURCHASE_INVOICE.IGST' | translate}} </th>
          <td class="text-right" mat-cell *matCellDef="let po" [innerHTML]="po.totalIgstAmount | customCurrency">
          </td>
        </ng-container>
        <ng-container matColumnDef="totalCessAmount">
          <th mat-header-cell *matHeaderCellDef  class="text-right"> {{'PURCHASE_INVOICE.CESS' | translate}} </th>
          <td class="text-right" mat-cell *matCellDef="let po" [innerHTML]="po.totalCessAmount | customCurrency">
          </td>
        </ng-container>
        <ng-container matColumnDef="totalAdnlCessAmount">
          <th mat-header-cell *matHeaderCellDef  class="text-right"> {{'PURCHASE_INVOICE.ADDITIONAL_CESS' | translate}} </th>
          <td class="text-right" mat-cell *matCellDef="let po" [innerHTML]="po.totalAdnlCessAmount | customCurrency">
          </td>
        </ng-container>
        <ng-container matColumnDef="totalExpenses">
          <th mat-header-cell *matHeaderCellDef  class="text-right"> {{'PURCHASE_INVOICE.TOTAL_EXPENSES' | translate}} </th>
          <td class="text-right" mat-cell *matCellDef="let po" [innerHTML]="po.totalExpenses | customCurrency">
          </td>
        </ng-container>
        <ng-container matColumnDef="totalAmount">
          <th class="text-right" mat-header-cell *matHeaderCellDef > {{'PURCHASE_INVOICE.TOTAL_AMOUNT' | translate}} </th>
          <td class="text-right" mat-cell *matCellDef="let po" [innerHTML]="po.netTotal | customCurrency">
          </td>
        </ng-container>

        <ng-container matColumnDef="action-search">
          <th mat-header-cell *matHeaderCellDef> </th>
        </ng-container>
    
        <form [formGroup]="filterForm" >

        <ng-container matColumnDef="docDate-search">
          <th mat-header-cell *matHeaderCellDef>
            <div class="filterDate col-md-12">
              <date-input [group]="filterForm" [controlName]="'docDate'" [label]="''" [isShowLabel]="false" [isDefaultDate]="false"></date-input>
            </div>
            <button class="dateRemove" mat-icon-button color="warn" (click)="removeDate()" *ngIf ="filterForm.get('docDate').value">
              <mat-icon>cancel</mat-icon>
            </button>
          </th>
        </ng-container>

        <ng-container matColumnDef="docNo-search">
          <th mat-header-cell *matHeaderCellDef>
              <input class="form-control" placeholder="Doc No" formControlName="docNo">

          </th>
        </ng-container>

      </form>
        <ng-container matColumnDef="refBillDate-search">
          <th mat-header-cell *matHeaderCellDef> </th>
        </ng-container>

        <ng-container matColumnDef="refBillNo-search">
          <th mat-header-cell *matHeaderCellDef>  </th>
        </ng-container>
        <ng-container matColumnDef="supplierName-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="transactionMode-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalDiscount-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalCgstAmount-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalSgstAmount-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalIgstAmount-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalCessAmount-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalAdnlCessAmount-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalExpenses-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>
        <ng-container matColumnDef="totalAmount-search">
          <th mat-header-cell *matHeaderCellDef>
          </th>
        </ng-container>


        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell text-center" [attr.colspan]="displayedColumns.length">
              {{'COMMON.NO_DATA_FOUND' | translate}}
          </td>
        </tr>

        <ng-container matColumnDef="footer">
          <td mat-footer-cell colspan="15" *matFooterCellDef>
            <mat-paginator [length]="purchaseInvoiceResource.totalCount" [pageSize]="purchaseInvoiceResource.pageSize"
              [pageSizeOptions]="pageSizeOptions" showFirstLastButtons>
            </mat-paginator>
          </td>
        </ng-container>
        <ng-container *hasClaim="'purchase_purchase_invoice_list_purchase_invoice_items'">
        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let poObject" [attr.colspan]="displayedColumns.length">
            <ng-container *ngIf="poObject == expandedElement">
              <div class="example-element-detail"
                [@detailExpand]="poObject == expandedElement ? 'expanded' : 'collapsed'">
                <div class="inner-table mat-elevation-z8">
                  <app-purchase-item [purchaseOrder]="poObject.purchaseInvoiceUUID">
                  </app-purchase-item>
                </div>
              </div>
            </ng-container>
          </td>
        </ng-container>
      </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns;sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <tr mat-header-row *matHeaderRowDef="filterColumns;sticky: true">
        <tr mat-footer-row *matFooterRowDef="footerToDisplayed;sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
      </table>

    </div>
  </div>
</div>
